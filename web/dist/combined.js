angular.module("scarecrow",["ngResource","ngRoute","ngCookies","ui.bootstrap","ui.date","scarecrow.controllers","scarecrow.common.services"]).config(["$routeProvider",function(a){a.when("/signup",{templateUrl:"views/signup.html",controller:"SignupCtrl"}).when("/",{templateUrl:"views/home/home.html",controller:"HomeCtrl"}).otherwise({redirectTo:"/"})}]),angular.module("scarecrow.common.services",[]),angular.module("scarecrow.common.services").factory("Child",[function(){var a=function(a){var b=new Date;if(a.year>b.getFullYear())return!1;if(a.month<1||a.month>12)return!1;if(a.day<1)return!1;switch(a.month){case 1:case 3:case 5:case 7:case 8:case 10:case 12:return a.day<=31;case 2:return a.day<=29;case 4:case 6:case 9:case 11:return a.day<=30;default:return!1}},b=function(){this.firstname="",this.lastname="",this.birthdate={},this.socialSecurityNbr="",this.allergys="",this.heading="Enfant"};return b.prototype.updateHeading=function(){""!=this.firstname&&""!=this.lastname&&(this.heading=this.firstname+" "+this.lastname)},b.prototype.isValid=function(){return""!=this.firstname&&""!=this.lastname&&""!=this.socialSecurityNbr&&a(this.birthdate)},b}]),angular.module("scarecrow.controllers",["ui.bootstrap","ngCookies","scarecrow.common.services"]),angular.module("scarecrow.controllers").controller("HomeCtrl",["$scope",function(){}]);var apiUri="http://localhost:8585";angular.module("scarecrow.controllers").controller("LoginCtrl",["$scope","$modal","$http","$log","$cookieStore",function(a,b,c,d,e){var f=function(){a.user={email:""},a.isModal=!1,a.isAuthenticated=!1,a.errorVisible=!1};f(),a.login=function(){a.isModal=!0;var f=b.open({templateUrl:"/views/login.html",controller:loginInstanceCtrl,resolve:{http:function(){return c},cookieStore:function(){return e}}});f.result.then(function(b){a.isAuthenticated=!0,a.user.email=b},function(){a.isModal=!1,d.info("Modal dismissed at: "+new Date)})},a.logout=function(){var b=e.get("token");c.post(apiUri+"/auth/logout",{email:a.user.email,token:b}).success(function(){f(),e.remove("token")}).error(function(a){console.log(a.message)})}}]);var loginInstanceCtrl=function(a,b,c,d){a.login=function(){var e={email:a.myEmail,password:a.myPassword};console.log("trying to log "+JSON.stringify(e)),c.post(apiUri+"/auth/login/?",e).success(function(a){console.log("token: "+a.token),d.put("token",a.token),b.close(e.email)}).error(function(b){console.log("login failed: "+b.message),a.errorVisible=!0})},a.cancel=function(){b.dismiss("cancel")}},apiUri="http://localhost:8585";angular.module("scarecrow.controllers").controller("SignupCtrl",["$scope","$http","$location","$route","Child",function(a,b,c,d,e){var f={IN_PROGRESS:1,SUCCESS:2,FAIL:3},g={SIGN_UP:1,READ_PROFILE:2,EDIT_PROFILE:3},h=function(a){return console.log("path: "+a),"/signup"===a?g.SIGN_UP:g.READ_PROFILE},i=new Date;a.maxYear=i.getFullYear(),a.allChildrenValid=!0,a.user={children:[]},a.status=f.IN_PROGRESS,a.errorMessage="",a.mode=h(c.path()),a.signup=function(){b.post(apiUri+"/auth/signup",{user:a.user}).success(function(){console.log("signup succeeded"),a.status=f.SUCCESS}).error(function(b){console.log("signup failed: "+b.message),a.status=f.FAIL,a.errorMessage=b.message})},a.addChild=function(){for(var b=!0,c=0;c<a.user.children.length;c++){var d=a.user.children[c];d.updateHeading(),d.isValid()||(b=!1)}a.allChildrenValid=b,a.allChildrenValid&&(a.lastChild=new e,a.user.children.push(a.lastChild))},a.removeChild=function(b){a.user.children.splice(b,1)},a.statusIsInProgress=function(){return a.status===f.IN_PROGRESS},a.statusIsSuccess=function(){return a.status===f.SUCCESS},a.statusIsFail=function(){return a.status===f.FAIL},a.modeIsSignUp=function(){return a.mode===g.SIGN_UP}}]);